<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Deriv_Trade — Demo Dashboard (Deriv-style)</title>
<meta name="description" content="Deriv_Trade demo dashboard - Deriv-style sidebar, demo trading, M-Pesa Till 3675058." />
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg:#000;
    --panel:#0d0d0f;
    --accent:#e30613;
    --muted:#bdbdbd;
    --glass: rgba(255,255,255,0.02);
    --success:#2bd17d;
    --danger:#ff5b5b;
    --sidebar-w: 260px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:var(--bg);color:#fff;-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}

  /* layout */
  .app{display:flex;min-height:100vh}
  /* sidebar */
  .sidebar{
    width:var(--sidebar-w);
    background:linear-gradient(180deg,#070707,#0b0b0b);
    border-right:1px solid rgba(255,0,0,0.04);
    padding:18px;
    display:flex;flex-direction:column;gap:18px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#9a0000);display:flex;align-items:center;justify-content:center;font-weight:900}
  .brand h2{margin:0;font-size:16px;color:var(--accent)}
  .menu{margin-top:8px;display:flex;flex-direction:column;gap:6px}
  .menu button{background:transparent;border:none;color:#fff;text-align:left;padding:10px;border-radius:8px;cursor:pointer;font-weight:700}
  .menu button:hover{background:rgba(255,0,0,0.06)}
  .menu .active{background:rgba(227,6,19,0.09);border-left:4px solid var(--accent);padding-left:14px}

  .sidebar .card{background:#0b0b0b;padding:12px;border-radius:10px;border:1px solid #121212}

  /* main area */
  .main{flex:1;display:flex;flex-direction:column}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid rgba(255,0,0,0.03)}
  .top-ticker{display:flex;gap:12px;align-items:center;overflow:auto}
  .tick{padding:8px;border-radius:8px;background:#0b0b0b;min-width:120px;border-left:4px solid rgba(227,6,19,0.9)}
  .tick .s{font-weight:800}
  .tick .p{color:var(--muted);margin-top:6px}

  /* workspace */
  .workspace{display:grid;grid-template-columns:1fr 360px;gap:18px;padding:18px}
  @media (max-width:980px){ .workspace{grid-template-columns:1fr} .sidebar{display:none} }

  /* center */
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), var(--glass));padding:12px;border-radius:12px;border:1px solid #141414}
  .chart-wrap{height:440px;border-radius:10px;padding:8px;background:#060606;border:1px solid #111}
  .controls{display:flex;gap:12px;align-items:center;margin-top:10px}
  .select, .input{background:#0b0b0b;border:1px solid rgba(255,0,0,0.06);padding:10px;border-radius:8px;color:#fff}

  /* trade panel */
  .trade-panel{position:relative}
  .trade-panel .panel{position:sticky;top:18px}
  .trade-panel h4{color:var(--accent);margin:0}
  .trade-row{display:flex;gap:8px;align-items:center;margin-top:10px}
  .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:800}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .btn.sell{background:#222;border:1px solid rgba(255,255,255,0.03)}
  .small{font-size:13px;color:var(--muted)}

  /* orders / history */
  .orders{margin-top:12px;max-height:200px;overflow:auto}
  .order{padding:10px;border-radius:8px;background:#0b0b0b;border-left:4px solid rgba(227,6,19,0.9);margin-bottom:8px;display:flex;justify-content:space-between;gap:8px}
  .order .meta{color:var(--muted);font-size:13px}

  /* footer area */
  footer{padding:12px 18px;border-top:1px solid rgba(255,0,0,0.03);color:var(--muted);text-align:center}

  /* alerts */
  .alerts{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px;z-index:200}
  .alert{background:#111;padding:10px 12px;border-radius:8px;border-left:4px solid var(--accent);box-shadow:0 10px 30px rgba(0,0,0,0.6);min-width:220px}

  /* responsive tweaks */
  @media (max-width:600px){
    .topbar{flex-direction:column;align-items:flex-start;gap:10px}
  }
</style>
</head>
<body>
<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div class="logo">DT</div>
      <div>
        <h2>Deriv_Trade</h2>
        <div class="small">Demo • Till 3675058</div>
      </div>
    </div>

    <div class="menu" id="menu">
      <button class="active" data-view="dashboard" onclick="setView('dashboard')">Dashboard</button>
      <button data-view="trade" onclick="setView('trade')">Trade</button>
      <button data-view="markets" onclick="setView('markets')">Markets</button>
      <button data-view="payments" onclick="setView('payments')">Payments</button>
      <button data-view="account" onclick="setView('account')">Account</button>
      <button data-view="help" onclick="setView('help')">Help</button>
    </div>

    <div class="sidebar-footer" style="margin-top:auto">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Demo Balance</div>
            <div style="font-weight:900" id="sideBalance">KES 10,000</div>
          </div>
          <div style="text-align:right">
            <div class="small">Open P/L</div>
            <div id="sidePL">KES 0</div>
          </div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn" onclick="depositDemo()">Deposit</button>
          <button class="btn ghost" onclick="resetDemo()">Reset</button>
        </div>
      </div>

      <div style="margin-top:12px" class="card">
        <div class="small">Support</div>
        <a class="btn ghost" href="https://wa.me/254796518099" target="_blank">WhatsApp</a>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- topbar -->
    <div class="topbar">
      <div style="display:flex;gap:18px;align-items:center">
        <div style="display:flex;align-items:center;gap:16px">
          <div style="font-weight:800;font-size:18px;color:var(--accent)">Deriv_Trade</div>
          <div class="small">Black & Red Demo</div>
        </div>

        <div class="top-ticker" id="topTicker">
          <!-- ticks injected via JS -->
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <div class="small">Logged in as <strong>DemoUser</strong></div>
        <button class="btn ghost" onclick="exportHistory()">Export</button>
      </div>
    </div>

    <!-- workspace -->
    <div class="workspace">
      <!-- CENTER: Chart + controls -->
      <section>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-size:18px;font-weight:800" id="assetTitle">EUR / USD</div>
              <div class="small" id="assetSub">Forex • Major</div>
            </div>
            <div style="display:flex;gap:12px;align-items:center">
              <div class="small">Spread: <strong id="assetSpread">0.8</strong></div>
              <div class="small">Leverage: <strong id="assetLev">50x</strong></div>
            </div>
          </div>

          <div style="margin-top:12px" class="chart-wrap">
            <canvas id="mainChart"></canvas>
          </div>

          <div class="controls" style="margin-top:12px">
            <select id="assetSelect" class="select" onchange="changeAsset(this.value)">
              <option value="EURUSD">EUR/USD</option>
              <option value="GBPUSD">GBP/USD</option>
              <option value="BTCUSD">BTC/USD</option>
              <option value="XAUUSD">XAU/USD</option>
              <option value="USDJPY">USD/JPY</option>
            </select>

            <div style="display:flex;gap:8px;align-items:center">
              <input id="sizeInput" class="input" type="number" min="0.01" step="0.01" value="1" style="width:100px" />
              <select id="leverageSelect" class="select">
                <option>10</option><option>25</option><option selected>50</option><option>100</option>
              </select>
            </div>

            <button class="btn" onclick="openOrder('buy')">Buy</button>
            <button class="btn sell" onclick="openOrder('sell')">Sell</button>
          </div>

          <div class="orders" id="orderBook">
            <!-- orders show here -->
          </div>
        </div>

        <!-- Signals / Market news (demo) -->
        <div style="margin-top:12px" class="panel">
          <h4 style="color:var(--accent);margin:0">Signals & Market</h4>
          <div class="small" style="margin-top:8px">Demo signals for learning purposes</div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <div class="card" style="flex:1">
              <div style="font-weight:800">BUY EUR/USD</div>
              <div class="small">TP 1.0990 • SL 1.0790</div>
            </div>
            <div class="card" style="flex:1">
              <div style="font-weight:800">SELL XAU/USD</div>
              <div class="small">TP 2280 • SL 2330</div>
            </div>
          </div>
        </div>

      </section>

      <!-- RIGHT: Trade panel -->
      <aside class="trade-panel">
        <div class="panel">
          <h4>Trade Panel</h4>
          <div class="small">Place demo orders — execution simulated with countdown</div>

          <div style="margin-top:12px">
            <label class="small">Selected asset</label>
            <div style="font-weight:800" id="panelAsset">EUR/USD</div>

            <label class="small" style="margin-top:8px">Order size</label>
            <input id="panelSize" class="input" type="number" value="1" step="0.01" />

            <label class="small" style="margin-top:8px">Leverage</label>
            <select id="panelLev" class="select">
              <option>10</option><option>25</option><option selected>50</option><option>100</option>
            </select>

            <div style="display:flex;gap:8px;margin-top:10px">
              <button class="btn" onclick="placeTrade('buy')">Place Buy</button>
              <button class="btn sell" onclick="placeTrade('sell')">Place Sell</button>
              <button class="btn ghost" onclick="closeAll()">Close All</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4 style="margin:0;color:var(--accent)">Account</h4>
            <div class="small" style="margin-top:8px">Balance</div>
            <div style="font-weight:900" id="accountBalance">KES 10,000</div>
            <div class="small" style="margin-top:8px">Open P/L</div>
            <div id="accountPL">KES 0</div>
          </div>

          <div style="margin-top:12px">
            <h4 style="margin:0">Recent Trades</h4>
            <div id="recentTrades" class="orders" style="max-height:140px"></div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn ghost" onclick="exportHistory()">Export</button>
              <button class="btn ghost" onclick="resetDemo()">Reset</button>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h4>Payments</h4>
          <div class="small">Preferred: M-Pesa Till</div>
          <div style="font-weight:900;color:var(--accent);margin-top:6px">3675058</div>
          <div style="margin-top:8px" class="small">After payment send txn ID via WhatsApp</div>
          <div style="margin-top:10px">
            <button class="btn" onclick="depositDemo()">Demo Deposit</button>
            <button class="btn ghost" onclick="showAlert('Payment instructions: Use M-Pesa Till 3675058','info')">How to pay</button>
          </div>
        </div>
      </aside>
    </div>

    <footer>
      © <span id="year"></span> Deriv_Trade — Demo environment. Not for real money trading.
    </footer>
  </main>
</div>

<!-- ALERTS -->
<div class="alerts" id="alerts"></div>

<script>
/* ---------------------------
   INITIAL SETUP & STATE
   --------------------------- */
document.getElementById('year').innerText = new Date().getFullYear();

const ASSETS = {
  EURUSD: { symbol:'EUR/USD', base:1.0864, spread:0.8, type:'forex' },
  GBPUSD: { symbol:'GBP/USD', base:1.2741, spread:1.0, type:'forex' },
  BTCUSD: { symbol:'BTC/USD', base:37850, spread:50, type:'crypto' },
  XAUUSD: { symbol:'XAU/USD', base:1840.30, spread:1.8, type:'commodity' },
  USDJPY: { symbol:'USD/JPY', base:147.82, spread:2, type:'forex' }
};

let currentAsset = 'EURUSD';
let demoState = JSON.parse(localStorage.getItem('deriv_demo_state') || JSON.stringify({
  balance: 10000,
  orders: [], // open orders
  history: [] // closed
}));

function saveState(){ localStorage.setItem('deriv_demo_state', JSON.stringify(demoState)); updateUI(); }
function resetDemo(){ if(confirm('Reset demo account?')){ demoState = { balance:10000, orders:[], history:[] }; saveState(); showAlert('Demo reset','info'); } }

function updateUI(){
  document.getElementById('sideBalance').innerText = 'KES ' + Math.round(demoState.balance);
  document.getElementById('accountBalance').innerText = 'KES ' + Math.round(demoState.balance);
  const openPL = demoState.orders.reduce((s,o)=> s + (o.pnl||0), 0);
  document.getElementById('sidePL').innerText = 'KES ' + Math.round(openPL);
  document.getElementById('accountPL').innerText = 'KES ' + Math.round(openPL);
  renderOrders();
  renderRecent();
  document.getElementById('assetTitle').innerText = ASSETS[currentAsset].symbol;
  document.getElementById('panelAsset').innerText = ASSETS[currentAsset].symbol;
  document.getElementById('assetSpread').innerText = ASSETS[currentAsset].spread;
  document.getElementById('assetLev').innerText = document.getElementById('leverageSelect') ? document.getElementById('leverageSelect').value : '50x';
}
updateUI();

/* ---------------------------
   TOP TICKER (simulated)
   --------------------------- */
const topTicker = document.getElementById('topTicker');
function initTicker(){
  topTicker.innerHTML = '';
  Object.keys(ASSETS).forEach(k=>{
    const t = document.createElement('div'); t.className='tick';
    t.innerHTML = `<div class="s">${ASSETS[k].symbol}</div><div class="p">${formatPrice(ASSETS[k].base,k)}</div>`;
    topTicker.appendChild(t);
  });
}
function tickTicker(){
  Object.keys(ASSETS).forEach((k, idx)=>{
    const asset = ASSETS[k];
    const vol = asset.type === 'crypto' ? 0.02 : 0.002;
    const next = +(asset.base * (1 + (Math.random()-0.5)*vol)).toFixed(asset.type==='crypto'?0:4);
    asset.base = next;
  });
  // refresh DOM
  Array.from(topTicker.children).forEach((el, i)=>{
    const k = Object.keys(ASSETS)[i];
    el.querySelector('.p').innerText = formatPrice(ASSETS[k].base, k);
  });
}
function formatPrice(v, key){
  if(key === 'BTCUSD' || key === 'XAUUSD') return '$' + Number(v).toLocaleString();
  if(key === 'USDJPY') return v.toFixed(2);
  return v.toFixed(4);
}
initTicker();
setInterval(tickTicker, 2500);

/* ---------------------------
   MAIN CHART (Chart.js simulated)
   --------------------------- */
const ctx = document.getElementById('mainChart').getContext('2d');
let chartLabels = [], chartData = [];
for(let i=30;i>=0;i--){ chartLabels.push(new Date(Date.now()-i*60000).toLocaleTimeString().slice(0,5)); chartData.push(ASSETS[currentAsset].base); }
const mainChart = new Chart(ctx, {
  type:'line',
  data: { labels: chartLabels, datasets:[{ data: chartData, borderColor: 'rgba(227,6,19,0.95)', backgroundColor:'rgba(227,6,19,0.06)', tension:0.25, pointRadius:0 }] },
  options: { responsive:true, plugins:{ legend:{display:false} }, scales:{ x:{ display:true }, y:{ display:true } } }
});
function pushChart(){
  const next = +(ASSETS[currentAsset].base * (1 + (Math.random()-0.5)*0.003)).toFixed(currentAsset==='BTCUSD'?0:4);
  mainChart.data.labels.push(new Date().toLocaleTimeString().slice(0,5));
  mainChart.data.datasets[0].data.push(next);
  if(mainChart.data.labels.length>60){ mainChart.data.labels.shift(); mainChart.data.datasets[0].data.shift(); }
  mainChart.update();
  // update pnl evaluation
  evaluateOpenPnl();
}
setInterval(()=>{
  // simulate asset base movement too
  const key = currentAsset;
  ASSETS[key].base = +(ASSETS[key].base * (1 + (Math.random()-0.5)*0.003)).toFixed(key==='BTCUSD'?0:4);
  pushChart();
}, 3500);

/* ---------------------------
   ORDERS / DEMO TRADING
   - openOrder: creates a pending order with 10s countdown
   - execute pending -> fills at current price and becomes open position
   - close position -> realize P/L and return margin + pnl to balance
   --------------------------- */
function openOrder(side){
  // small UI-based quick open (center chart controls)
  const size = parseFloat(document.getElementById('sizeInput').value) || 1;
  const lev = parseInt(document.getElementById('leverageSelect').value) || 50;
  createPending(side, size, lev);
}
function createPending(side, size, lev){
  const entry = ASSETS[currentAsset].base;
  const margin = Math.max(50, Math.round((size * (currentAsset==='BTCUSD' ? entry/100 : entry)) / lev));
  if(demoState.balance < margin){ showAlert('Insufficient demo balance for margin KES ' + margin, 'error'); return; }
  demoState.balance -= margin;
  const pending = {
    id: 'p'+Date.now(),
    side, symbol: currentAsset, size, lev, entry, margin,
    status:'pending', created: Date.now(), countdown:10, time: new Date().toLocaleTimeString()
  };
  demoState.orders.push(pending);
  saveStateDebounced();
  showAlert(`${side.toUpperCase()} pending: execution in 10s`, 'info');
  // start countdown
  const tickId = setInterval(()=>{
    pending.countdown--;
    saveStateDebounced();
    if(pending.countdown <=0){
      clearInterval(tickId);
      executeOrder(pending.id);
    }
  },1000);
}
function executeOrder(pendingId){
  const idx = demoState.orders.findIndex(o=>o.id===pendingId);
  if(idx === -1) return;
  const o = demoState.orders[idx];
  // fill price: current asset base +- tiny slippage
  const slippage = (Math.random()-0.5) * (o.side==='buy' ? 0.0002 : 0.0002);
  const execPrice = +(ASSETS[o.symbol].base * (1 + slippage)).toFixed(o.symbol==='BTCUSD'?0:4);
  const position = {
    id: 'pos'+Date.now(),
    side: o.side, symbol:o.symbol, size:o.size, lev:o.lev, entry: execPrice,
    margin: o.margin, status:'open', openedAt: new Date().toLocaleString(), pnl:0
  };
  // remove pending and add position in history (store open positions in orders array)
  demoState.orders.splice(idx,1);
  demoState.orders.push(position);
  saveStateDebounced();
  showAlert(`${position.side.toUpperCase()} executed @ ${position.entry}`, 'success');
}
function evaluateOpenPnl(){
  demoState.orders.forEach(o=>{
    if(o.status !== 'open') return;
    const current = ASSETS[o.symbol].base;
    const sign = o.side === 'buy' ? 1 : -1;
    const pnl = Math.round((current - o.entry) * o.size * 1000 * sign); // simplified
    o.pnl = pnl;
  });
  saveStateDebounced();
}
function closeAll(){
  if(demoState.orders.length === 0) { showAlert('No open positions','info'); return; }
  let realized = 0;
  // close all open positions
  const remaining = [];
  demoState.orders.forEach(o=>{
    if(o.status === 'open'){
      const pnl = o.pnl || 0;
      realized += pnl;
      demoState.balance += o.margin + pnl;
      demoState.history.push({ side:o.side, symbol:o.symbol, size:o.size, entry:o.entry, pnl, closedAt: new Date().toLocaleString() });
    } else {
      // pending orders refunded margin + cancelled
      if(o.status === 'pending'){
        demoState.balance += o.margin; // refund
        demoState.history.push({ side:o.side, symbol:o.symbol, remark:'pending cancelled', closedAt: new Date().toLocaleTimeString() });
      }
    }
  });
  demoState.orders = remaining;
  saveStateDebounced();
  showAlert('All positions closed. Realized KES ' + realized, 'success');
}
function placeTrade(side){
  // right panel trade placement
  const size = parseFloat(document.getElementById('panelSize').value) || 1;
  const lev = parseInt(document.getElementById('panelLev').value) || 50;
  createPending(side, size, lev);
}

/* ---------------------------
   RENDER ORDERS & HISTORY
   --------------------------- */
function renderOrders(){
  const el = document.getElementById('orderBook'); el.innerHTML = '';
  if(demoState.orders.length === 0){ el.innerHTML = '<div class="small muted">No positions or pending orders</div>'; return; }
  demoState.orders.slice().reverse().forEach(o=>{
    const div = document.createElement('div'); div.className = 'order';
    if(o.status === 'pending'){
      div.innerHTML = `<div><strong>${o.side.toUpperCase()} (pending)</strong><div class="meta">Asset: ${ASSETS[o.symbol].symbol} • Size: ${o.size} • Margin: KES ${o.margin}</div></div>
                      <div style="text-align:right"><div class="small">Exec in ${o.countdown}s</div><div class="small">${o.time}</div></div>`;
    } else if(o.status === 'open' || o.id && o.id.startsWith('pos')){
      div.innerHTML = `<div><strong>${o.side.toUpperCase()}</strong><div class="meta">Entry: ${o.entry} • Size: ${o.size} • Margin: KES ${o.margin}</div></div>
                      <div style="text-align:right"><div style="font-weight:800">${o.pnl? 'KES '+o.pnl : 'KES 0'}</div><div class="small">${o.openedAt||o.time||''}</div></div>`;
    } else {
      div.innerHTML = `<div><strong>${o.side}</strong><div class="meta">Status: ${o.status}</div></div>`;
    }
    el.appendChild(div);
  });
}
function renderRecent(){
  const el = document.getElementById('recentTrades'); el.innerHTML = '';
  if(!demoState.history || demoState.history.length ===0){ el.innerHTML = '<div class="small muted">No history</div>'; return; }
  demoState.history.slice().reverse().slice(0,8).forEach(h=>{
    const d = document.createElement('div'); d.className='order'; d.innerHTML = `<div><strong>${h.side || ''} ${h.symbol||''}</strong><div class="meta">${h.closedAt || h.time || ''}</div></div><div style="text-align:right"><div class="small">${h.pnl? 'KES '+h.pnl : h.remark || ''}</div></div>`;
    el.appendChild(d);
  });
}

/* ---------------------------
   UTILITIES: alerts, export
   --------------------------- */
function showAlert(msg, type='info', t=4500){
  const wrap = document.getElementById('alerts');
  const el = document.createElement('div'); el.className='alert'; el.innerHTML = `<div style="font-weight:800">${msg}</div><div class="small">${type}</div>`;
  wrap.appendChild(el); setTimeout(()=> el.remove(), t);
}
function exportHistory(){
  const content = JSON.stringify(demoState, null, 2);
  const blob = new Blob([content], { type:'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'deriv_trade_demo_history.json'; a.click();
  URL.revokeObjectURL(url);
  showAlert('Export ready','info');
}

/* ---------------------------
   HELPERS & small UI actions
   --------------------------- */
function setView(v){
  document.querySelectorAll('#menu button').forEach(b=>b.classList.remove('active'));
  const btn = document.querySelector(`#menu button[data-view="${v}"]`);
  if(btn) btn.classList.add('active');
  showAlert(`Switched to ${v}`, 'info', 1400);
}
function changeAsset(val){
  currentAsset = val;
  document.getElementById('assetTitle').innerText = ASSETS[val].symbol;
  document.getElementById('panelAsset').innerText = ASSETS[val].symbol;
  // reset chart with new base
  mainChart.data.datasets[0].data = mainChart.data.datasets[0].data.map(()=>ASSETS[val].base);
  mainChart.update();
  showAlert('Switched to ' + ASSETS[val].symbol, 'info');
}
function depositDemo(){
  const v = parseFloat(prompt('Enter deposit KES amount', '1000'));
  if(!v || isNaN(v) || v<=0){ showAlert('Invalid amount','error'); return; }
  demoState.balance += v; saveStateDebounced(); showAlert('Demo deposit KES ' + v,'success');
}

/* ---------------------------
   STATE SAVE debounce and init
   --------------------------- */
let saveTimeout = null;
function saveStateDebounced(){
  if(saveTimeout) clearTimeout(saveTimeout);
  saveTimeout = setTimeout(()=>{ localStorage.setItem('deriv_demo_state', JSON.stringify(demoState)); updateUI(); }, 300);
}
function saveStateImmediate(){ localStorage.setItem('deriv_demo_state', JSON.stringify(demoState)); updateUI(); }
saveStateImmediate();

/* expose some funcs to window for buttons */
window.depositDemo = depositDemo;
window.resetDemo = resetDemo;
window.openOrder = openOrder;
window.openTrade = openOrder;
window.placeTrade = placeTrade;
window.closeAll = closeAll;
window.exportHistory = exportHistory;
window.setView = setView;

/* initial render */
renderOrders();
renderRecent();
updateUI();

</script>
</body>
                </html>
